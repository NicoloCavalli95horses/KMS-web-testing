{
	"nodes":[
		{
			"id":"93565c2855173055",
			"type":"text",
			"text":"## `<summary>` DOM element to detect user interaction\n\nThe GET request will be executed ==only when the user clicks== to expand the summary. Regular `<img>` are requested all together\n\n```html\n<details>\n  <summary>Click me</summary>\n  <div style=\"background: url('https://picsum.photos/200/300')\" />\n</details>\n```",
			"styleAttributes":{"border":"invisible"},
			"x":1640,
			"y":-1040,
			"width":680,
			"height":400
		},
		{
			"id":"c19544b96987387b",
			"type":"text",
			"text":"| Provider     | Effective | Description                                                          \n| -----------  | --------- | -----------                                   \n| Proton       |  ✅        |                                                     \n| Gmail        |  ❌         |  `<details>` turned into `<div>`\n| Yahoo        |  ❌        |   `<details>` turned into `<div>`, warns external images      \n| Outlook     |   ❌       |  `<details>` turned into `<div>`      \n| Apple        |                |           \n",
			"styleAttributes":{"textAlign":"center","border":"invisible"},
			"x":1640,
			"y":-680,
			"width":680,
			"height":340
		},
		{
			"id":"ecea64c839f4b57a",
			"type":"text",
			"text":"| Provider     | Effective | Description                                                        \n| -----------  | --------- | -----------                                             \n| Gmail        |  ✅       | access to CSS var `--gm3-sys-color-error`     \n| Proton       |  ✅       | access to CSS var `--signal-success`             \n| Yahoo        |  ❌       | CSS var defined, `--var()` is forbidden              \n| Outlook     |  ❌       | CSS var defined, `--var()` is forbidden              \n| Apple        |              |                                                                        \n",
			"styleAttributes":{"textAlign":"center","border":"invisible"},
			"x":-880,
			"y":-580,
			"width":800,
			"height":270
		},
		{
			"id":"660ea28823c91c90",
			"type":"text",
			"text":"## `--var()` API to detect user device and track mail opening\n\nThis will use a local CSS variable in the web viewer, and will display the picture in the mobile version. An attacker can infer\n - if the user opened the email via the Gmail mobile application\n - when exactly the user opened the email (GET request timestamp)\n\n```html\n<div style=\"\n  width: 200px;\n  height: 300px;\n  background: var(--gm3-sys-color-error, url('https://picsum.photos/200/300'))\"\n/>\n```",
			"styleAttributes":{"border":"invisible"},
			"x":-880,
			"y":-1040,
			"width":880,
			"height":460
		},
		{
			"id":"025c8d48f0a296c7",
			"type":"text",
			"text":"## `if()` API to detect user screen size, browser version (estimated), user agent (estimated)\n\nThe new `if()` property allows us to style DOM elements based on conditions. Critically, this property can be defined in inline-style, and can still access style, media and features queries. Among the sensitive APIs, there is: `@media`, `@orientation`, `@supports` \n\nAn attacker can abuse this new api to:\n - get approximate viewport size of the device\n - get aspect ratio\n - get its orientation (portrait/landscape)\n - identify outdated browsers (`@supports` property): this can lead to the refinement of subsequent attacks\n - detect when exactly the user opened the email (GET request timestamp)\n\n```html\n<div style=\"\n  width: 100vw;\n  height: 100vh;\n  background: if(\n    media((width > 500px)): red;\n    else: url('https://picsum.photos/200/300')\n  ); !important\"\n />\n   <h1>test</h1>   \n </div>\n```\n\nThis code force the browser to conditionally execute a GET request depending on the attacker-controlled width size. The `<h1>` tag is recommended (email can be otherwise automatically blocked by filters if no content is detected)",
			"styleAttributes":{"border":"invisible"},
			"x":320,
			"y":-1100,
			"width":1000,
			"height":920
		},
		{
			"id":"ba0313b5ad564f5f",
			"type":"text",
			"text":"| Provider     | Effective | Description                                                         \n| -----------  | --------- | -----------                                   \n| Proton       |  ✅        | textual content is mandatory    \n| Gmail        |  ❌         | `if()` is forbidden                                \n| Yahoo        |  ❌        | `if()` is forbidden                               \n| Outlook     |  ❌        |  `if()` is forbidden                               \n| Apple        |                |                     \n",
			"styleAttributes":{"textAlign":"center","border":"invisible"},
			"x":320,
			"y":-180,
			"width":500,
			"height":260
		},
		{
			"id":"77621248fc6ff0d4",
			"type":"text",
			"text":"| Provider     | Effective | Description                           \n| -----------  | --------- | -----------                                  \n| Proton       | ❌        |  removed from inline CSS                     \n| Gmail        |  ❌         | removed from inline CSS                \n| Yahoo        | ❌         | removed from inline CSS    \n| Outlook     |  ✅        | removed from inline CSS    \n| Apple        |                |     \n",
			"styleAttributes":{"textAlign":"center","border":"invisible"},
			"x":3550,
			"y":-700,
			"width":560,
			"height":260
		},
		{
			"id":"57398bed4e378dd2",
			"type":"text",
			"text":"## Inline `svg` (`background-image`)\n\n```html\n<div style=\"width=200px;height:200px;background-image:url(&quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' %3E%3ClinearGradient id='gradient'%3E%3Cstop offset='10%25' stop-color='%23F00'/%3E%3Cstop offset='90%25' stop-color='%23fcc'/%3E%3C/linearGradient%3E%3Crect fill='url(%23gradient)' width='100%25' height='100%25'/%3E%3C/svg%3E&quot;);\">\n</div>\n```",
			"styleAttributes":{"border":"invisible"},
			"x":3520,
			"y":-1090,
			"width":740,
			"height":380
		},
		{
			"id":"37a2ffdf3718ca78",
			"type":"text",
			"text":"## `-moz-element()` API\n\nSupported by Firefox, allows you to copy the content of another `<div>` with arbitrary ID\n- Works only with IDs, and only on DOM elements (no `<script>`)\n- How to communicate the copied information externally?\n\n```html\n<div id=\"secret\">secret</div>\n<div style=\"\n  width: 100px;\n  height: 100px;\n  background: -moz-element(#secret) no-repeat;\n\">.</div>\n```",
			"styleAttributes":{"border":"invisible"},
			"x":2620,
			"y":-1070,
			"width":620,
			"height":460
		},
		{
			"id":"0c5c81ec85eafd96",
			"type":"text",
			"text":"| Provider     | Effective | Description                           \n| -----------  | --------- | -----------                                  \n| Proton       |  ✅        |                                    \n| Gmail        |  ❌         | removed from inline CSS                \n| Yahoo        | ❌         | removed from inline CSS    \n| Outlook     |  ❌        | removed from inline CSS    \n| Apple        |                |     \n",
			"styleAttributes":{"textAlign":"center","border":"invisible"},
			"x":2650,
			"y":-610,
			"width":560,
			"height":240
		}
	],
	"edges":[],
	"metadata":{
		"version":"1.0-1.0",
		"frontmatter":{}
	}
}